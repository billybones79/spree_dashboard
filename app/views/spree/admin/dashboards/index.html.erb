<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.4/nv.d3.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.4/nv.d3.css" />


<div class="col-md-4">
  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">Ventes par r√©gion des 3 derniers mois</h3>
    </div>
    <div class="panel-body">
      <div id="chart" style="height:400px">
        <svg></svg>
      </div>
    </div>
  </div>
</div>
<div class="col-md-6">
  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">Ventes des 3 derniers mois</h3>
    </div>
    <div class="panel-body">
      <div id="line_bar" style="height:400px">
        <svg></svg>
      </div>
    </div>
  </div>
</div>
<div class="col-md-6">
  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">Nouveaux utilisateurs des 3 derniers mois</h3>
    </div>
    <div class="panel-body">
      <div id="user-chart">
        <svg></svg>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript" charset="utf-8">
  //Pie
  nv.addGraph(function() {
    var region_data = <%= @pie_data.to_json.html_safe %>;
    var chart = nv.models.pieChart()
      .x(function(d) { return d.label })
      .y(function(d) { return d.value })
      .showLabels(true)
      .showLegend(false)
      .showTooltipPercent(true)
    .valueFormat(function(d) { return d3.format(',f')(d) + '$' })
    ;

    d3.select("#chart svg")
      .datum(region_data)
      .transition().duration(1200)
      .call(chart);
    nv.utils.windowResize(chart.update);

    return chart;
  });

  // Line
nv.addGraph(function() {
  var chart;
  var data = <%= @order_line_bar_data.to_json.html_safe %>;
  data.map(function(series) {
            series.values = series.values.map(function(d) { return {x: d[0], y: d[1] } });
            return series;
        });
  chart = nv.models.linePlusBarChart()
    .margin({top: 50, right: 80, bottom: 30, left: 80})
    .color(d3.scale.category10().range());
  chart.xAxis.tickFormat(function(d) {
    return d3.time.format('%x')(new Date(d))
  }).showMaxMin(false);
  chart.y2Axis.tickFormat(function(d) { return d3.format(',f')(d) + '$' });
  chart.bars.forceY([0]).padData(false);
  chart.x2Axis.tickFormat(function(d) {
    return d3.time.format('%x')(new Date(d))
  }).showMaxMin(false);
  d3.select('#line_bar svg')
    .datum(data)
    .transition().duration(500).call(chart);
  nv.utils.windowResize(chart.update);
  return chart;
});

    //User bar
  nv.addGraph(function() {
    var user_data = <%= @user_data.to_json.html_safe %>;
    user_data.map(function(series) {
      series.values = series.values.map(function(d) { return {x: d[0], y: d[1] } });
      return series;
    });
    var chart = nv.models.historicalBar()
        ;

    d3.select("#user-chart svg")
        .datum(user_data)
        .transition()
        .call(chart);
    nv.utils.windowResize(chart.update);

    return chart;
  });

</script>
